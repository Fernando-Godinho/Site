{% extends 'website/base.html' %}
{% block content %}
<section class="py-20" x-data="fadeIn">
  <div class="mx-auto lg:container max-w-[var(--container-max)] px-6">
    <div class="grid grid-cols-2 gap-12 items-center">
      <div class="rounded-lg overflow-hidden">
        <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&h=800&fit=crop" alt="DiagnÃ³stico empresarial" class="w-full h-full object-cover rounded-lg">
      </div>
      <div>
        <h1 class="text-4xl font-bold mb-2">Descubra onde sua empresa estÃ¡ perdendo tempo e dinheiro</h1>
        <p class="text-slate-600 mb-8">Preencha o formulÃ¡rio abaixo e receba uma anÃ¡lise personalizada.</p>
        <form id="contactForm" class="space-y-5">
          {% csrf_token %}
          <div>
            <label class="text-sm font-semibold text-slate-700 block mb-2">Nome completo</label>
            <input name="name" placeholder="Seu nome" class="input input-bordered w-full rounded-lg py-2.5" required>
          </div>
          <div>
            <label class="text-sm font-semibold text-slate-700 block mb-2">Empresa</label>
            <input name="company" placeholder="Nome da empresa" class="input input-bordered w-full rounded-lg py-2.5">
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-semibold text-slate-700 block mb-2">Cargo</label>
              <input name="role" placeholder="Seu cargo" class="input input-bordered w-full rounded-lg py-2.5">
            </div>
            <div>
              <label class="text-sm font-semibold text-slate-700 block mb-2">NÂº de colaboradores</label>
              <input name="employees_count" placeholder="Ex: 50" type="number" class="input input-bordered w-full rounded-lg py-2.5">
            </div>
          </div>
          <div>
            <label class="text-sm font-semibold text-slate-700 block mb-2">WhatsApp</label>
            <input name="whatsapp" placeholder="(11) 99999-9999" type="tel" class="input input-bordered w-full rounded-lg py-2.5">
          </div>
          <div>
            <label class="text-sm font-semibold text-slate-700 block mb-2">Principal desafio</label>
            <textarea name="main_challenge" placeholder="Descreva seu maior desafio operacional..." class="textarea textarea-bordered w-full rounded-lg py-2.5" rows="4"></textarea>
          </div>
          <div>
            <button type="submit" class="btn btn-md btn-primary px-8 py-3 text-base font-semibold w-full rounded-lg">Agendar diagnÃ³stico gratuito</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- Modal de Sucesso -->
<dialog id="successModal" class="modal modal-bottom sm:modal-middle">
  <div class="modal-box bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-green-400">
    <div class="flex justify-center mb-6">
      <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center animate-bounce">
        <svg class="w-10 h-10 text-green-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
      </div>
    </div>
    
    <h3 class="font-bold text-2xl text-center mb-2 text-slate-800">Ã“timo! Recebemos seu contato ðŸŽ‰</h3>
    <p class="text-center text-slate-600 mb-6">Um especialista da Sumconnect jÃ¡ vai entrar em contato com vocÃª em instantes via WhatsApp ou email.</p>
    
    <div class="bg-white rounded-lg p-4 mb-6 border-l-4 border-blue-500">
      <p class="text-sm text-slate-700"><strong>O que esperar:</strong></p>
      <ul class="text-sm text-slate-600 mt-2 space-y-1">
        <li>âœ“ AnÃ¡lise personalizada do seu negÃ³cio</li>
        <li>âœ“ Oportunidades de automaÃ§Ã£o</li>
        <li>âœ“ Sem compromisso ou custo</li>
      </ul>
    </div>
    
    <div class="modal-action">
      <button class="btn btn-primary w-full rounded-lg" onclick="document.getElementById('successModal').close(); location.reload();">Voltar ao site</button>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button type="button">fechar</button>
  </form>
</dialog>

<script>
  document.getElementById('contactForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const submitButton = this.querySelector('button[type="submit"]');
    const originalText = submitButton.textContent;
    
    // Mostrar loading
    submitButton.disabled = true;
    submitButton.textContent = 'Enviando...';
    
    fetch('{% url "contact" %}', {
      method: 'POST',
      body: formData,
      headers: {
        'X-Requested-With': 'XMLHttpRequest',
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Limpar formulÃ¡rio
        document.getElementById('contactForm').reset();
        // Mostrar modal
        document.getElementById('successModal').showModal();
      }
    })
    .catch(error => {
      console.error('Erro:', error);
      alert('Houve um erro ao enviar o formulÃ¡rio. Tente novamente.');
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    })
    .finally(() => {
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    });
  });
</script>
{% endblock %}
